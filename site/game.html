<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sarp Niti — Demo</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="container">
    <div class="nav">
      <a href="index.html"><strong>← Playniti</strong></a>
      <div><small>1-minute Demo</small></div>
    </div>

    <div class="card center">
      <canvas id="canvas" width="480" height="480" style="background:#0e1626;border:1px solid #22304b;border-radius:10px"></canvas>
      <div style="margin-top:10px">
        <strong>Time:</strong> <span id="time">60</span>s &nbsp; | &nbsp;
        <strong>Score:</strong> <span id="score">0</span>
      </div>
      <div style="margin-top:8px"><small>Controls: Arrow keys or WASD. Mobile: swipe.</small></div>
      <div style="margin-top:12px">
        <button class="btn" onclick="startGame()">Start</button>
      </div>
    </div>

    <div class="card">
      <h3>Local Leaderboard (this device)</h3>
      <table class="table" id="lb">
        <thead><tr><th>#</th><th>Score</th><th>Date</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

<script>
let grid=16, tile=30, snake, dir, food, score, timer, timeLeft, running=false, lastTouch;

const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
canvas.width=grid*tile;
canvas.height=grid*tile;

function reset(){
  snake=[{x:8,y:8}];
  dir={x:1,y:0};
  placeFood();
  score=0;
  timeLeft=60;
  document.getElementById('score').textContent=score;
  document.getElementById('time').textContent=timeLeft;
}
function placeFood(){
  food={x:Math.floor(Math.random()*grid), y:Math.floor(Math.random()*grid)};
}

function loop(){
  if(!running) return;
  const head={x:(snake[0].x+dir.x+grid)%grid, y:(snake[0].y+dir.y+grid)%grid};
  // collision with body
  if(snake.some((s,i)=>i>0 && s.x===head.x&&s.y===head.y)){
    endGame(); return;
  }
  snake.unshift(head);
  if(head.x===food.x && head.y===food.y){
    score+=10;
    document.getElementById('score').textContent=score;
    placeFood();
  }else{
    snake.pop();
  }
  draw();
  setTimeout(loop, 100);
}

function draw(){
  ctx.fillStyle='#0e1626'; ctx.fillRect(0,0,canvas.width,canvas.height);
  // food
  ctx.fillStyle='#5b8cff'; ctx.fillRect(food.x*tile+4, food.y*tile+4, tile-8, tile-8);
  // snake
  ctx.fillStyle='#a1ffd1';
  snake.forEach((s,i)=>{
    ctx.fillRect(s.x*tile+2, s.y*tile+2, tile-4, tile-4);
  });
}

function startGame(){
  if(running) return;
  reset(); running=true; draw();
  clearInterval(timer);
  timer=setInterval(()=>{
    timeLeft--; document.getElementById('time').textContent=timeLeft;
    if(timeLeft<=0){ endGame(); }
  },1000);
  loop();
}

function endGame(){
  running=false; clearInterval(timer);
  saveScore(score);
  alert('Time up! Your score: '+score);
}

document.addEventListener('keydown', e=>{
  const k=e.key.toLowerCase();
  if(k==='arrowup'||k==='w'){ if(dir.y===0) dir={x:0,y:-1}; }
  if(k==='arrowdown'||k==='s'){ if(dir.y===0) dir={x:0,y:1}; }
  if(k==='arrowleft'||k==='a'){ if(dir.x===0) dir={x:-1,y:0}; }
  if(k==='arrowright'||k==='d'){ if(dir.x===0) dir={x:1,y:0}; }
});

canvas.addEventListener('touchstart', e=>{ const t=e.changedTouches[0]; lastTouch={x:t.clientX,y:t.clientY}; });
canvas.addEventListener('touchend', e=>{
  const t=e.changedTouches[0]; if(!lastTouch) return;
  const dx=t.clientX-lastTouch.x, dy=t.clientY-lastTouch.y;
  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>0 && dir.x===0) dir={x:1,y:0}; else if(dx<0 && dir.x===0) dir={x:-1,y:0};
  }else{
    if(dy>0 && dir.y===0) dir={x:0,y:1}; else if(dy<0 && dir.y===0) dir={x:0,y:-1};
  }
  lastTouch=null;
});

function saveScore(s){
  const key='playniti_snake_scores';
  const arr=JSON.parse(localStorage.getItem(key)||'[]');
  arr.push({s, t:Date.now()});
  arr.sort((a,b)=>b.s-a.s);
  localStorage.setItem(key, JSON.stringify(arr.slice(0,20)));
  renderLB();
}
function renderLB(){
  const key='playniti_snake_scores';
  const arr=JSON.parse(localStorage.getItem(key)||'[]');
  const tb=document.querySelector('#lb tbody'); tb.innerHTML='';
  arr.forEach((r,i)=>{
    const d=new Date(r.t).toLocaleString();
    tb.innerHTML+=`<tr><td>${i+1}</td><td>${r.s}</td><td>${d}</td></tr>`;
  });
}
renderLB();
</script>
</body>
</html>
